<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />
    
    <meta property="og:url" content="https:&#x2F;&#x2F;tune-your-chat.github.io&#x2F;blog&#x2F;2023&#x2F;08&#x2F;bridges-vulnerability-disclosure&#x2F;" />
    
    
    
    
    <meta property="og:title" content="Disclosure: Bridges security issues" />
    
    
    
    <meta property="og:description" content="Matrix, the open protocol for secure decentralised communications" />
    <meta name="description" content="Matrix, the open protocol for secure decentralised communications" />
    
    <meta property="og:image" content="https://matrix.org/blog/img/matrix-logo.png" />
    <meta name="twitter:image" content="https://matrix.org/blog/img/matrix-logo.png" />
    
    <title>Matrix.org - Disclosure: Bridges security issues</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="stylesheet" href=https://tune-your-chat.github.io/style.css?h=0d1a23c06b707a231261 />
    <script async src=https://tune-your-chat.github.io/js/components.js?h=ae3cb894d00e16ef08be></script>
    <script defer data-domain="matrix.org" src="https://plausible.io/js/script.tagged-events.js"></script>


    
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "Disclosure: Bridges security issues",
    "datePublished": "2023-08-04T10:30+00:00",
    
    
    "image": [
        "https://matrix.org/blog/img/matrix-logo.png"
    ],
    
    "author": [
    
    {
        "@type": "Person",
        "name": "Integrations Team",
        "url": "https://tune-your-chat.github.io/authors/integrations-team"
    },
    
    {
        "@type": "Person",
        "name": "Matrix Security Team",
        "url": "https://tune-your-chat.github.io/authors/matrix-security-team"
    }
    
    ]
}
</script>
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="https:&#x2F;&#x2F;spec.matrix.org" class="
            ">
            Spec
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="foundation-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="foundation-submenu-checkbox" class="submenu-title">Foundation <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;foundation&#x2F;about&#x2F;">About Matrix</a>
                    
                    <a href="&#x2F;foundation&#x2F;governing-board-elections&#x2F;">Governing Board Elections 2024</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            current">
            Blog
        </a>
        
        
        
        <a href="&#x2F;docs&#x2F;" class="
            ">
            Docs
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;tune&#x2F;">Tune Your Chat</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;integrations&#x2F;">Integrations</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;support" class="
            ">
            Donate
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<article class="content post with-sidebar">
    <header>
        <h1>Disclosure: Bridges security issues</h1>
        <span>
            04.08.2023 10:30
            
            —
            <a href="/category/bridges">Bridges</a>, <a href="/category/security">Security</a>
            
            —
            <a
                href="/author/integrations-team">Integrations Team</a>, 
            <a
                href="/author/matrix-security-team">Matrix Security Team</a>
            
        </span>
        
    </header>
    <div class="post-main">
        <div class="post-content">
            <p>Hi folks. As previously mentioned on <a href="https://matrix.org/blog/2023/07/bridges-security-updates/">Monday</a>, we’re now disclosing the vulnerabilities patched for the IRC, Slack and Hookshot bridges. If you have not already done so, please ensure you are running the patched versions.</p>
<p>Today we are disclosing the 3 vulnerabilities.</p>
<h2 id="matrix-appservice-bridge-doesn-t-verify-the-sub-parameter-of-an-openid-token-exchange-cve-2023-38691">matrix-appservice-bridge doesn't verify the sub parameter of an openId token exchange (CVE-2023-38691)</h2>
<p><a href="https://github.com/matrix-org/matrix-appservice-bridge/security/advisories/GHSA-vc7j-h8xg-fv5x">GHSA-vc7j-h8xg-fv5x</a> / <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38691">CVE-2023-38691</a></p>
<p>The <code>POST /v1/exchange_openid</code> endpoint did not check that the servername part of the <code>sub</code> parameter (containing the user's <em>claimed</em> MXID) is the same as the servername we are talking to. This could allow a malicious actor to spin up a server on any given domain, respond with a <code>sub</code> parameter according to the user they want to act as and use the resulting token to perform provisioning requests.</p>
<p>This is now patched so that the server part of the sub / user ID is checked against the server used to make the request.</p>
<p>Discovered and reported by a community member.</p>
<h2 id="irc-command-injection-via-admin-commands-containing-newlines-cve-2023-38690">IRC command injection via admin commands containing newlines (CVE-2023-38690)</h2>
<p><a href="https://github.com/matrix-org/matrix-appservice-irc/security/advisories/GHSA-3pmj-jqqp-2mj3">GHSA-3pmj-jqqp-2mj3</a> / <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38690">CVE-2023-38690</a></p>
<p>When the IRC bridge attempted to parse an admin command from a Matrix user, it would only split arguments by a literal space. For example, sending “!join #matrix\nfoobar” would treat the channel name as “#matrix\nfoobar”. This could then be exploited to inject any IRC command into the bridge to be run. Since the !join command first joins via the bridge bot user, it could be used to execute commands as the bridge bot.</p>
<p>This is now patched so that both the command handler is more strict about its arguments, as well as channel names being explicitly validated when provided by users.</p>
<p>Discovered and reported by <a href="https://valentin-lorentz.fr/">Val Lorentz</a>.</p>
<h2 id="events-can-be-crafted-to-leak-parts-of-targeted-messages-from-other-bridged-rooms-cve-2023-38700">Events can be crafted to leak parts of targeted messages from other bridged rooms (CVE-2023-38700)</h2>
<p><a href="https://github.com/matrix-org/matrix-appservice-irc/security/advisories/GHSA-c7hh-3v6c-fj4q">GHSA-c7hh-3v6c-fj4q</a> / <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-38700">CVE-2023-38700</a></p>
<p>The IRC bridge caches recent timeline messages in memory, so that when a reply is seen for a message it doesn’t need to request the event content from the homeserver. However the room ID was not validated when accessing this cache, so a malicious actor could craft a reply event in another room referencing any event ID (so long as it was still in the bridge cache) to trick the bridge into posting the message content into a bridged reply.</p>
<p>Discovered and reported by <a href="https://valentin-lorentz.fr/">Val Lorentz</a>.</p>
<p>If you have further questions, please reach out on <a href="mailto:security@matrix.org">security@matrix.org</a></p>

            <div class="callout">
                <div class="left-col">
                    <h2>The Foundation needs you</h2>
                </div>
                <div class="right-col">
                    <p>
                        The Matrix.org Foundation is a non-profit and only relies
                        on donations to operate. Its core mission is to maintain
                        the Matrix Specification, but it does much more than that.
                    </p>
                    <p>
                        It maintains the matrix.org homeserver and hosts several
                        bridges for free. It fights for our collective rights to
                        digital privacy and dignity.
                    </p>
                    <a class="call-to-action plausible-event-name=BlogPostCtaSupportUs" href="/support">Support us</a>
                </div>
            </div>
        </div>
        
        <aside>
            <h3>Post Contents</h3>

            <ul style="list-style: none; padding-left: 0px;">
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/08/bridges-vulnerability-disclosure/#matrix-appservice-bridge-doesn-t-verify-the-sub-parameter-of-an-openid-token-exchange-cve-2023-38691">matrix-appservice-bridge doesn&#x27;t verify the sub parameter of an openId token exchange (CVE-2023-38691)</a>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/08/bridges-vulnerability-disclosure/#irc-command-injection-via-admin-commands-containing-newlines-cve-2023-38690">IRC command injection via admin commands containing newlines (CVE-2023-38690)</a>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/08/bridges-vulnerability-disclosure/#events-can-be-crafted-to-leak-parts-of-targeted-messages-from-other-bridged-rooms-cve-2023-38700">Events can be crafted to leak parts of targeted messages from other bridged rooms (CVE-2023-38700)</a>
                    
                </li>
                
            </ul>
        </aside>
        
    </div>
</article>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;support">Donate</a>
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org">Shop</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org" rel="me"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;" rel="me"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix" rel="me"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg" rel="me"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w" rel="me"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
            <a href="&#x2F;atom.xml" rel="me"><img src="/assets/rss.svg" alt="RSS"></a>
            
        </div>
    </div>
    <p><a href="/legal/copyright-notice">Copyright Notice</a></p>
</footer>

</body>

</html>
