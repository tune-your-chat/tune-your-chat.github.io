<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="twitter:widgets:csp" content="on" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@matrixdotorg" />
    <meta name="twitter:creator" content="@matrixdotorg" />
    
    <meta property="og:url" content="https:&#x2F;&#x2F;tune-your-chat.github.io&#x2F;blog&#x2F;2023&#x2F;07&#x2F;what-happened-with-the-archive&#x2F;" />
    
    
    
    
    <meta property="og:title" content="What happened with archive.matrix.org" />
    
    
    
    <meta property="og:description" content="Matrix, the open protocol for secure decentralised communications" />
    <meta name="description" content="Matrix, the open protocol for secure decentralised communications" />
    
    <meta property="og:image" content="https://matrix.org/blog/img/matrix-logo.png" />
    <meta name="twitter:image" content="https://matrix.org/blog/img/matrix-logo.png" />
    
    <title>Matrix.org - What happened with archive.matrix.org</title>
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="stylesheet" href=https://tune-your-chat.github.io/style.css?h=0d1a23c06b707a231261 />
    <script async src=https://tune-your-chat.github.io/js/components.js?h=ae3cb894d00e16ef08be></script>
    <script defer data-domain="matrix.org" src="https://plausible.io/js/script.tagged-events.js"></script>


    
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": "What happened with archive.matrix.org",
    "datePublished": "2023-07-04T14:24+00:00",
    
    
    "image": [
        "https://matrix.org/blog/img/matrix-logo.png"
    ],
    
    "author": [
    
    {
        "@type": "Person",
        "name": "Matthew Hodgson",
        "url": "https://tune-your-chat.github.io/authors/matthew-hodgson"
    },
    
    {
        "@type": "Person",
        "name": "Thib",
        "url": "https://tune-your-chat.github.io/authors/thib"
    }
    
    ]
}
</script>
</head>

<body>
    
    <header class="site-header">
    <a href="/" class="brand">
        <img src="/images/matrix-logo-white.svg" alt="Matrix logo">
    </a>
    <input id="site-header-dropdown-checkbox" type="checkbox" class="dropdown-checkbox" aria-hidden="true">
    <label for="site-header-dropdown-checkbox" class="dropdown-button">&#xe602;</label>
    <label for="site-header-dropdown-checkbox" class="page-overlay"></label>
    <nav>
        
        
        <a href="https:&#x2F;&#x2F;spec.matrix.org" class="
            ">
            Spec
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="foundation-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="foundation-submenu-checkbox" class="submenu-title">Foundation <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;foundation&#x2F;about&#x2F;">About Matrix</a>
                    
                    <a href="&#x2F;foundation&#x2F;governing-board-elections&#x2F;">Governing Board Elections 2024</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;blog&#x2F;" class="
            current">
            Blog
        </a>
        
        
        
        <a href="&#x2F;docs&#x2F;" class="
            ">
            Docs
        </a>
        
        
        
        
        
        <div class="section-wrap">
            <input id="ecosystem-submenu-checkbox" type="checkbox" class="submenu-checkbox" aria-hidden="true"
                >
            <label for="ecosystem-submenu-checkbox" class="submenu-title">Ecosystem <div class="arrow">
                </div></label>

            <div class="section-submenu-wrap">
                <div class="section-submenu">
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;clients&#x2F;">Clients</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;bridges&#x2F;">Bridges</a>
                    
                    
                    <a href="&#x2F;ecosystem&#x2F;servers&#x2F;">Servers</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;tune&#x2F;">Tune Your Chat</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;integrations&#x2F;">Integrations</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;sdks&#x2F;">SDKs</a>
                    
                    <a href="&#x2F;ecosystem&#x2F;hosting&#x2F;">Hosting</a>
                    
                </div>
            </div>
        </div>
        
        
        
        <a href="&#x2F;support" class="
            ">
            Donate
        </a>
        
        
        
        <a href="&#x2F;try-matrix&#x2F;" class="primary
            ">
            Try Matrix
        </a>
        
        
    </nav>
</header>


    <main>
        
<article class="content post with-sidebar">
    <header>
        <h1>What happened with archive.matrix.org</h1>
        <span>
            04.07.2023 14:24
            
            —
            <a href="/category/general">General</a>
            
            —
            <a
                href="/author/matthew-hodgson">Matthew Hodgson</a>, 
            <a
                href="/author/thib">Thib</a>
            
        </span>
        
    </header>
    <div class="post-main">
        <div class="post-content">
            <p>We launched the Matrix Public Archive <a href="https://www.youtube.com/watch?v=ULbvBIwiGEI">publicly on June 2nd, 2023</a>.
We decided to take it down on Sunday, June 25th out of precaution after a
member of OFTC staff warned us that the archive made the content of two OFTC IRC
channels bridged to Matrix available on the Internet.</p>
<p>After investigating the issue, we determined that the Matrix Public Archive's
behaviour was expected for these channels, given an IRC chanop had
<strong>explicitly</strong> configured the Matrix side of the rooms to be world-readable.</p>
<p>Let's talk about how room visibility works in vanilla Matrix, how it works with
bridges, and what are the next steps.</p>
<span id="continue-reading"></span><h2 id="tl-dr">TL;DR</h2>
<ul>
<li>archive.matrix.org does <strong>not</strong> expose history for Matrix rooms (or channels
bridged from IRC) unless a room admin (aka IRC chanop) has explicitly
configured that room to be world-readable.</li>
<li>There was confusion over this because the UI failed to explain <em>why</em> a given
room is viewable (or not), and folks didn't realise that some rooms had
explicitly been configured as world-readable in the dim and distant past.</li>
<li>archive.matrix.org is <strong>not</strong> an indexer or an archive - it's just a read-only
matrix client. It doesn't store any messages. We're going to find a better
name for it.</li>
<li>The only reason the @archive:matrix.org bot joins rooms when someone views
them via archive.matrix.org is because the Peek API is deprecated - and rather
than implementing a deprecated API to view the room without joining, the
service explicitly joins the room instead. Once peeking (e.g. <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/2753">MSC2753</a>)
lands, then the bot won't be needed any more.</li>
</ul>
<h2 id="room-visibility-in-matrix">Room Visibility in Matrix</h2>
<p>Matrix rooms have some flexibility regarding whether new members can see the
history of a room or not. People interested in technical details can check the
<a href="https://spec.matrix.org/v1.2/client-server-api/#room-history-visibility">Room History Visibility in the specification</a>.
The history visibility possibilities are the following, by increasing order of
openness (least open first):</p>
<ul>
<li><code>joined</code>: people need to join the room to see the history, and will only see
the messages sent after they joined. This behaviour is similar to the
experience of IRC on a bouncer, and is how all IRC channels are bridged to
Matrix by default</li>
<li><code>invited</code>: people need to join the room to see the history, and will only see
the messages after they were invited.</li>
<li><code>shared</code>: people need to join the room to see the history, but will then see
the history up to when this visibility setting was set (the change is not
retroactive).</li>
<li><code>world_readable</code>: <em>everyone can see the room history</em> without even joining the
room.</li>
</ul>
<p>Element is <a href="https://matrix.org/ecosystem/clients/">far from being the only Matrix client</a>
out there but is commonly used in the Matrix community. The visibility settings
described above are translated as follows in Element, by decreasing order of
openness:</p>
<p><img src="/blog/img/element-visibility-settings.png" alt="A screenshot of Element history visibility settings" /></p>
<p>An example of a world-readable room (with history visibility set to "Anyone" in
Element) is <a href="https://matrix.to/#/#matrix:matrix.org">Matrix HQ</a>. When trying to
reach it via <a href="https://matrix.to">matrix.to</a>, you can pick Element in a browser,
and it will show you a preview of the conversation.</p>
<p><img src="/blog/img/2-continue-in-browser.png" alt="A screenshot of matrix.to asking which client to use" /></p>
<p><img src="/blog/img/3-room-history.png" alt="A screenshot of matrix.to showing a preview of Matrix HQ" /></p>
<p>What is not necessarily obvious here is that Element Web creates a guest user
<em>who never joins the room</em> in order to peek into it. Indeed, the guest is only
created to be able to use Element, and then the guest is looking at a preview of
the room (as defined in the <a href="https://spec.matrix.org/v1.7/client-server-api/#room-previews">Room Previews section of the spec</a>):
they're able to read the history without ever joining. All of this is defined
for each room, and is vanilla Matrix without any involvement of the Matrix
Public Archive.</p>
<h2 id="room-visibility-and-irc-bridging">Room Visibility and IRC Bridging</h2>
<p>It is important to note that the Libera Chat and OFTC bridges hosted by the
Matrix.org Foundation (and any other bridged powered by a vanilla <a href="https://github.com/matrix-org/matrix-appservice-irc">matrix-appservice-irc</a>),
mimic the IRC behaviour by default when creating the rooms: their visibility is
set to <code>joined</code>, a.k.a. "People need to join the room to see history and will
only see new messages since they joined". In other words, by default, <strong>IRC
channel history is only ever visible to users currently in the channel - it is
never shared with other users.</strong></p>
<p>For the sake of completeness, let's cover the two types of rooms that exist when
bridging a room to IRC, and the implications on history visibility control.</p>
<h3 id="portalled-rooms">Portalled rooms</h3>
<p>When someone tries to join #example:libera.chat, the bridge is going to create
this room and automatically bridge it to the #example channel on Libera Chat.
The Bridge Bot user (@appservice:libera.chat) is the owner of the room and has
the maximum power level (PL100).</p>
<p>Nobody on the Matrix side has privileges when the room is created. No Matrix
user can change the visibility of this room. If someone from the IRC side
promotes the IRC representation of a Matrix user as op in the channel, the
bridge bot will promote said user to the power level 50 on the Matrix side. This
Matrix user will be able to change the visibility of the room on the Matrix
side, and opt-in for a world-readable visibility.</p>
<h3 id="plumbed-rooms">Plumbed rooms</h3>
<p>When someone takes an existing Matrix room and tries to manually plug it (or
plumb it) to an IRC channel, they can do so using a widget for interactive
configuration. The Matrix user needs to specify which is the IRC network and
channel they want to bridge to, and the nick of the IRC op who can approve that
request.</p>
<p><img src="/blog/img/4-irc-link-widget.png" alt="&quot;A screenshot of a widget offering to plumb a Matrix room to IRC&quot;" /></p>
<p>Plumbing a room in this fashion requires someone with sufficient privileges in
the IRC channel to approve the request. In plumbed rooms, the Matrix user who
made the plumbing request has the maximum power level in this room (usually
PL100). They are in total control of the history visibility, which can be
world-readable from the start. It's worth reiterating that such rooms can only
be linked to IRC when an IRC chanop approves the plumbing request.</p>
<h2 id="the-matrix-public-archive-is-not-an-archive">The Matrix Public Archive is not an archive</h2>
<p>In retrospect, the Matrix Public Archive is a terrible name for this project -
all the webapp does is to act as a read-only Matrix client for world-readable
content. It doesn't archive anything; it doesn't store anything; it just pulls
data from world-readable rooms on the Matrix homeserver, and exposes it to the
web.</p>
<p>The Matrix Public Archive also depends on a bot joining the room to assess
whether the room is world-readable or not, purely because the original peeking
APIs in Matrix are deprecated, and the new ones (<a href="https://github.com/matrix-org/matrix-spec-proposals/pull/2753">MSC2753</a>)
haven't landed yet. In the case of the Matrix Public Archive hosted by the
Matrix.org Foundation, that bot is <code>@archive:matrix.org</code>.  However, the bot user
is not reading any information which wasn't already publicly visible without
joining the room - but we can see why having a random bot join is scary,
especially when it's called ‘archive', and it's not actually archiving anything.</p>
<h3 id="wait-my-room-s-world-readable">Wait, my room's world readable?!</h3>
<p>The most obvious issue is that some people were surprised that their room was
world readable in the first place. Some rooms have a long history themselves,
and it's entirely possible for some admins to have inherited a room someone else
created, made public, and never revisited the settings. It then came as a
surprise for them that their room history was in the Matrix Public Archive at
all.</p>
<p>When matrix.to was introduced, some room administrators also set up their rooms
to <code>world_readable</code> so potential joiners could peek at what was happening in the
room. Earlier in Matrix history, guest accounts were popular in some communities
and people also made their room <code>world_readable</code> to onboard guests more easily.
All of this leads us to the same two issues today.</p>
<p>First, it should be made clearer in the UI of archive.matrix.org on <em>why</em> a room
is world-readable (i.e. "A room admin (chanop) called Bob set the room to be
world-readable on Jan 2, 2018"). And moreover, Matrix clients in general could
do a better job of calling out when a room's history can be read by everyone,
including people who didn't join. Second, the room settings may not make it
obvious enough that sharing the history with "anyone" literally means "anyone"
and not "anyone who has joined".</p>
<h3 id="a-note-on-shared-history-visibility">A note on shared history visibility</h3>
<p>Having a public room doesn't necessarily mean you want everyone to be able to
read the whole history. Initially, the Matrix Public Archive also made rooms
with <code>shared</code> history visibility readable via the archive.matrix.org interface
(acting as a read-only client, effectively) but disallowed search engines to
index that content. A <code>shared</code> room is a room where, having joined, you can see
the whole history of the room.</p>
<p>In retrospect, this was a thinko - <code>shared</code> history doesn't mean you expect
anonymous users to be able to read history (otherwise you'd have set it
<code>world_readable</code>), and we've subsequently <a href="https://github.com/matrix-org/matrix-public-archive/pull/239">merged a fix</a>
kindly provided by tulir to address this.</p>
<h2 id="next-up">Next up</h2>
<p>By default, portalled IRC rooms were already set with <code>joined</code> history
visibility which prevented them from being in the archive at all. We have
additionally prevented the Matrix.org hosted public archive from exposing the
content of portalled rooms that are bridged to Libera Chat since June 7, and
rooms bridged to OFTC since June 27, regardless of their history visibility
setting.</p>
<p>Looking at <a href="https://libera.chat/policies/#public-logging">Libera Chat's Public logging policy</a>
there might be a way to make the bridge change the topic to be explicit about
the channel being publicly logged when the Matrix room is <code>world_readable</code>. This
feature doesn't exist yet, so we would rather prevent the archive from logging
any room bridged to their network.</p>
<p>We're investigating:</p>
<ul>
<li>Making it clear in the archive.matrix.org UI why a given room is world
readable (and thus showing up in the interface)</li>
<li>Renaming the archive (as Matrix Viewer?)</li>
<li>Avoiding bots ever joining rooms on behalf of the system; <code>world_readable</code>
privileges should mean by definition that nothing needs to join the room.</li>
<li>MSC2291 to act like <a href="https://en.wikipedia.org/wiki/Robots.txt">web's Robots Exclusion Protocol</a>,
at the room level</li>
</ul>
<h2 id="a-word-on-gdpr">A word on GDPR</h2>
<p>We understand that there have been some concerns around the GDPR compliance of
the Matrix Public Archive. As always, we hear you and welcome your feedback.</p>
<p>The first step we will take is actually rename the project, to clarify what its
technical purpose is. ‘Archiving' has very specific connotations within the
GDPR, mainly governed by art. 89. No further data is collected and archived
outside of your normal use of a Matrix homeserver, but there is indeed some
additional processing by further disseminating the data. We are making this
clearer in the matrix.org homeserver Privacy Notice.</p>
<p>This article requires measures around data minimisation to be taken when
archiving data in the public interest. We would argue that processing this data
only in a cache state, would meet this principle of minimisation. In fact,
removing data from the ‘archive' is as simple as <a href="https://github.com/matrix-org/matrix-public-archive/blob/main/docs/faq.md">deleting it from the room</a>.</p>
<p>If you have feedback on the legal aspects of this project, please send it over
to <a href="mailto:dpo@matrix.org">dpo@matrix.org</a>.</p>
<h2 id="next-steps">Next steps</h2>
<p>Once we've renamed the project and clarified the visibility settings, we'll be
turning archive.matrix.org back on. If you have any further feedback, please
talk to us at <a href="https://matrix.to/#/#matrix-public-archive:matrix.org">#matrix-public-archive:matrix.org</a>.</p>

            <div class="callout">
                <div class="left-col">
                    <h2>The Foundation needs you</h2>
                </div>
                <div class="right-col">
                    <p>
                        The Matrix.org Foundation is a non-profit and only relies
                        on donations to operate. Its core mission is to maintain
                        the Matrix Specification, but it does much more than that.
                    </p>
                    <p>
                        It maintains the matrix.org homeserver and hosts several
                        bridges for free. It fights for our collective rights to
                        digital privacy and dignity.
                    </p>
                    <a class="call-to-action plausible-event-name=BlogPostCtaSupportUs" href="/support">Support us</a>
                </div>
            </div>
        </div>
        
        <aside>
            <h3>Post Contents</h3>

            <ul style="list-style: none; padding-left: 0px;">
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#tl-dr">TL;DR</a>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#room-visibility-in-matrix">Room Visibility in Matrix</a>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#room-visibility-and-irc-bridging">Room Visibility and IRC Bridging</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#portalled-rooms">Portalled rooms</a>
                        </li>
                        
                        <li>
                            <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#plumbed-rooms">Plumbed rooms</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#the-matrix-public-archive-is-not-an-archive">The Matrix Public Archive is not an archive</a>
                    
                    <ul>
                        
                        <li>
                            <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#wait-my-room-s-world-readable">Wait, my room&#x27;s world readable?!</a>
                        </li>
                        
                        <li>
                            <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#a-note-on-shared-history-visibility">A note on shared history visibility</a>
                        </li>
                        
                    </ul>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#next-up">Next up</a>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#a-word-on-gdpr">A word on GDPR</a>
                    
                </li>
                
                <li>
                    <a href="https://tune-your-chat.github.io/blog/2023/07/what-happened-with-the-archive/#next-steps">Next steps</a>
                    
                </li>
                
            </ul>
        </aside>
        
    </div>
</article>

    </main>

    <footer class="site-footer">
    <div class="internal-links">
        
        <a href="&#x2F;support">Donate</a>
        
        <a href="https:&#x2F;&#x2F;shop.matrix.org">Shop</a>
        
        <a href="&#x2F;security-disclosure-policy">Security Disclosure Policy</a>
        
        <a href="&#x2F;security-hall-of-fame">Security Hall of Fame</a>
        
        <a href="&#x2F;legal&#x2F;code-of-conduct">Code of Conduct</a>
        
        <a href="&#x2F;legal">Legal</a>
        
        <a href="&#x2F;contact">Contact</a>
        
        <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org&#x2F;matrix.org&#x2F;">Site Source</a>
        
    </div>
    <div class="external-links">
        <div>
            
            <a href="https:&#x2F;&#x2F;github.com&#x2F;matrix-org" rel="me"><img src="/assets/github.svg" alt="GitHub"></a>
            
            <a href="https:&#x2F;&#x2F;gitlab.matrix.org&#x2F;" rel="me"><img src="/assets/gitlab.svg" alt="GitLab"></a>
            
            <a href="https:&#x2F;&#x2F;mastodon.matrix.org&#x2F;@matrix" rel="me"><img src="/assets/mastodon.svg" alt="Mastodon"></a>
            
            <a href="https:&#x2F;&#x2F;twitter.com&#x2F;matrixdotorg" rel="me"><img src="/assets/twitter.svg" alt="Twitter"></a>
            
            <a href="https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UCVFkW-chclhuyYRbmmfwt6w" rel="me"><img src="/assets/youtube.svg" alt="YouTube"></a>
            
            <a href="&#x2F;atom.xml" rel="me"><img src="/assets/rss.svg" alt="RSS"></a>
            
        </div>
    </div>
    <p><a href="/legal/copyright-notice">Copyright Notice</a></p>
</footer>

</body>

</html>
